<template>
  <div class="page-container">
    <h1 class="page-title">AI ÂΩ±ËßÜÂåñËÑöÊú¨Âàõ‰Ωú</h1>
    <p class="page-subtitle">‰ªé‰∏Ä‰∏™ÊÉ≥Ê≥ïÂà∞ÂØºÊºîÁ∫ßÂàÜÈïúËÑöÊú¨ÔºåAI ÂÖ®Á®ãÂä©Âäõ„ÄÇ</p>

    <el-row :gutter="24">
      <!-- Left Column: Control Panel -->
      <el-col :span="7">
        <el-card class="feature-card control-panel">
          <template #header>
            <div class="card-header">
              <span>Âàõ‰ΩúËÆæÁΩÆ</span>
            </div>
          </template>
          
          <!-- Ê®°ÊùøÈÄâÊã©ÂØπËØùÊ°Ü -->
          <el-dialog v-model="showTemplateDialog" title="ÈÄâÊã©Ê®°Êùø" width="500px">
            <div v-if="templates.length === 0" style="text-align: center; color: #999">
              ÊöÇÊó†‰øùÂ≠òÁöÑÊ®°Êùø
            </div>
            <div v-else>
              <div 
                v-for="template in templates" 
                :key="template.timestamp"
                class="template-item"
                @click="applyTemplate(template)"
                style="padding: 10px; border: 1px solid #eee; margin-bottom: 10px; border-radius: 4px; cursor: pointer"
              >
                <div style="font-weight: bold">{{ template.name }}</div>
                <div style="font-size: 12px; color: #666">
                  {{ new Date(template.timestamp).toLocaleString() }}
                </div>
              </div>
            </div>
          </el-dialog>
    
          <el-alert
            title="‚ö†Ô∏è ÊºîÁ§∫Ê®°ÂºèÔºöÂΩìÂâç‰∏∫Ê®°ÊãüÁîüÊàêÔºåÂÆûÈôÖ‰ΩøÁî®Êó∂Â∞ÜËøûÊé•ÁúüÂÆûAIÊúçÂä°"
            type="warning"
            :closable="false"
            style="margin-bottom: 15px"
          />
          
          <el-form :model="form" label-position="top">
            <el-form-item label="È°πÁõÆÊñá‰ª∂Â§π">
              <el-input v-model="projectPath" placeholder="Êú™ËÆæÁΩÆ" readonly>
                <template #append>
                  <el-button @click="selectProjectFolder">ÈÄâÊã©...</el-button>
                </template>
              </el-input>
              <div style="margin-top: 10px">
                <el-input 
                  v-model="projectSearch" 
                  placeholder="ÊêúÁ¥¢È°πÁõÆ..." 
                  :prefix-icon="Search"
                  clearable
                />
              </div>
            </el-form-item>
            <el-form-item label="ÊïÖ‰∫ãÊ†∏ÂøÉ‰∏ªÈ¢ò">
              <el-input
                v-model="form.topic"
                type="textarea"
                :rows="3"
                placeholder="‰æãÂ¶ÇÔºö‰∏Ä‰∏™Á®ãÂ∫èÂëòÂú®ËµõÂçöÊúãÂÖãÈÉΩÂ∏Ç‰∏≠ÂØªÊâæ‰∏¢Â§±ÁöÑÊï∞Â≠óÁå´"
              >
                <template #append>
                  <el-button @click="optimizeTitle" :icon="MagicStick">AI‰ºòÂåñ</el-button>
                </template>
              </el-input>
            </el-form-item>
            <el-form-item label="ÁÉ≠Èó®Ê†áÁ≠æÊé®Ëçê">
              <div style="display: flex; gap: 5px; flex-wrap: wrap">
                <el-tag
                  v-for="tag in recommendedTags"
                  :key="tag"
                  effect="plain"
                  style="cursor: pointer"
                  @click="addTag(tag)"
                >
                  {{ tag }}
                </el-tag>
              </div>
            </el-form-item>

            <el-collapse v-model="activeCollapse" class="details-collapse">
              <el-collapse-item title="È´òÁ∫ßÂàõ‰ΩúÂèÇÊï∞" name="1">
                <el-form-item label="‰∏ªËßíËÆæÂÆö (ÂèØÈÄâ)">
                  <el-input
                    v-model="form.characterBio"
                    type="textarea"
                    :rows="3"
                    placeholder="‰∏ªËßíÂßìÂêç„ÄÅË∫´‰ªΩ„ÄÅÊÄßÊ†º„ÄÅÁõÆÊ†áÁ≠â"
                  />
                </el-form-item>
                <el-form-item label="ÊïÖ‰∫ãÂ§ßÁ∫≤ (ÂèØÈÄâ)">
                  <el-input
                    v-model="form.storyOutline"
                    type="textarea"
                    :rows="5"
                    placeholder="ÊïÖ‰∫ãÁöÑËµ∑Âõ†„ÄÅÁªèËøá„ÄÅÈ´òÊΩÆ„ÄÅÁªìÂ±Ä"
                  />
                </el-form-item>
                <el-form-item label="ÊåáÂÆöÂú∫ÊôØ (ÂèØÈÄâ)">
                  <el-input
                    v-model="form.specificScenes"
                    type="textarea"
                    :rows="3"
                    placeholder="Â∏åÊúõÂøÖÈ°ªÂá∫Áé∞ÁöÑÂÖ∑‰ΩìÂú∫ÊôØÊàñÊÉÖËäÇÔºåÊØèË°å‰∏Ä‰∏™"
                  />
                </el-form-item>
                <el-form-item label="Ë¥üÂêëÊèêÁ§∫ËØç (ÂèØÈÄâ)">
                  <el-input
                    v-model="form.negativePrompt"
                    type="textarea"
                    :rows="2"
                    placeholder="‰æãÂ¶ÇÔºöÈÅøÂÖçÂá∫Áé∞Êö¥Âäõ„ÄÅË°ÄËÖ•ÂÜÖÂÆπ"
                  />
                </el-form-item>
              </el-collapse-item>
            </el-collapse>

            <el-form-item label="ÈÄâÊã©ËßÜÈ¢ëÈ£éÊ†º">
              <el-select v-model="form.style" placeholder="ËØ∑ÈÄâÊã©È£éÊ†º" style="width: 100%;">
                <el-option label="ËµõÂçöÊúãÂÖã" value="cyberpunk" />
                <el-option label="ÁßëÂπªÊú™Êù•" value="sci-fi" />
                <el-option label="ÂõΩÈ£éÂ•áÂπª" value="fantasy-guofeng" />
                <el-option label="Ê∏©ÊÉÖÊó•Â∏∏" value="slice-of-life" />
              </el-select>
            </el-form-item>
            <el-form-item label="È¢Ñ‰º∞ÈïúÂ§¥Êï∞">
              <el-input-number v-model="form.shots" :min="3" :max="20" style="width: 100%;" />
            </el-form-item>
            
            <el-form-item label="ÂàÜÈïúËÑöÊú¨Ê®°Âºè">
              <el-switch v-model="form.storyboardMode" active-text="ÂêØÁî®ÂàÜÈïúÊ®°Âºè" inactive-text="Ê†áÂáÜÊ®°Âºè" />
            </el-form-item>
            
            <el-collapse v-model="storyboardCollapse" class="storyboard-collapse" v-if="form.storyboardMode">
              <el-collapse-item title="üé¨ ÂàÜÈïúËÑöÊú¨ËÆæÁΩÆ" name="storyboard">
                <el-form-item label="ÁîªÈù¢È£éÊ†ºÊèèËø∞">
                  <el-input
                    v-model="form.visualStyle"
                    type="textarea"
                    :rows="2"
                    placeholder="‰æãÂ¶ÇÔºöËµõÂçöÊúãÂÖãÈúìËôπÁÅØÂÖâ„ÄÅÁîµÂΩ±Á∫ßÊôØÊ∑±„ÄÅ4KË∂ÖÊ∏ÖÁîªË¥®"
                  />
                </el-form-item>
                <el-form-item label="ÈïúÂ§¥ËøêÂä®ÊñπÂºè">
                  <el-select v-model="form.cameraMovement" placeholder="ÈÄâÊã©ÈïúÂ§¥ËøêÂä®" style="width: 100%;">
                    <el-option label="ÈùôÊÄÅÈïúÂ§¥" value="static" />
                    <el-option label="Êé®ÊãâÈïúÂ§¥" value="push_pull" />
                    <el-option label="ÊëáÊëÑÈïúÂ§¥" value="pan" />
                    <el-option label="Ë∑üÊãçÈïúÂ§¥" value="tracking" />
                    <el-option label="ÊóãËΩ¨ÈïúÂ§¥" value="rotation" />
                    <el-option label="ÂçáÈôçÈïúÂ§¥" value="crane" />
                  </el-select>
                </el-form-item>
                <el-form-item label="ÂÖâÂΩ±ÊïàÊûú">
                  <el-select v-model="form.lightingEffect" placeholder="ÈÄâÊã©ÂÖâÂΩ±ÊïàÊûú" style="width: 100%;">
                    <el-option label="Ëá™ÁÑ∂ÂÖâ" value="natural" />
                    <el-option label="ÊàèÂâßÊÄßÂÖâÂΩ±" value="dramatic" />
                    <el-option label="ÈúìËôπÁÅØÂÖâ" value="neon" />
                    <el-option label="ÈÄÜÂÖâÂâ™ÂΩ±" value="backlight" />
                    <el-option label="ÊüîÂÖâÊª§Èïú" value="soft" />
                    <el-option label="Á°¨ÂÖâÂØπÊØî" value="hard" />
                  </el-select>
                </el-form-item>
                <el-form-item label="Ëâ≤ÂΩ©Ë∞ÉÊÄß">
                  <el-select v-model="form.colorTone" placeholder="ÈÄâÊã©Ëâ≤ÂΩ©Ë∞ÉÊÄß" style="width: 100%;">
                    <el-option label="ÂÜ∑Ëâ≤Ë∞É" value="cool" />
                    <el-option label="ÊöñËâ≤Ë∞É" value="warm" />
                    <el-option label="È´òÂØπÊØîÂ∫¶" value="high_contrast" />
                    <el-option label="‰ΩéÈ•±ÂíåÂ∫¶" value="desaturated" />
                    <el-option label="ËµõÂçöÊúãÂÖã" value="cyberpunk" />
                    <el-option label="Â§çÂè§ËÉ∂Áâá" value="vintage" />
                  </el-select>
                </el-form-item>
              </el-collapse-item>
            </el-collapse>
            
            <el-form-item>
              <el-row :gutter="10" style="width: 100%;">
                <el-col :span="12">
                  <el-button :icon="FolderOpened" @click="loadProject" style="width: 100%;">Âä†ËΩΩÈ°πÁõÆ</el-button>
                </el-col>
                <el-col :span="12">
                  <el-button type="primary" :icon="FolderAdd" @click="saveProject" style="width: 100%;">‰øùÂ≠òÈ°πÁõÆ</el-button>
                </el-col>
              </el-row>
            </el-form-item>

            <el-form-item>
              <el-button type="primary" @click="generateScript" :loading="loading" size="large" style="width: 100%;">
                <el-icon style="margin-right: 8px;"><MagicStick /></el-icon>
                {{ loading ? 'AI Ê≠£Âú®ÂÖ®ÂäõÂàõ‰Ωú‰∏≠...' : 'ÁîüÊàêÂØºÊºîÁ∫ßËÑöÊú¨' }}
              </el-button>
              <div style="margin-top: 10px; display: flex; gap: 5px">
                <el-button @click="saveAsTemplate" type="warning" plain style="flex: 1">
                  ‰øùÂ≠òÊ®°Êùø
                </el-button>
                <el-button @click="loadTemplate" type="info" plain style="flex: 1">
                  Âä†ËΩΩÊ®°Êùø
                </el-button>
              </div>
            </el-form-item>
          </el-form>
        </el-card>
      </el-col>

      <!-- Right Column: Results -->
      <el-col :span="17">
        <div class="result-container" v-loading="loading" element-loading-text="AIÊÄùËÄÉ‰∏≠ÔºåËØ∑Á®çÂÄô...">
          <div v-if="!result" class="placeholder">
            <el-empty description="Âú®Â∑¶‰æßËæìÂÖ•Âàõ‰ΩúË¶ÅÊ±ÇÔºåÂºÄÂßãÊÇ®ÁöÑAIÂΩ±ËßÜ‰πãÊóÖ" />
          </div>
          <div v-else>
            <!-- Ê†áÂáÜÊ®°ÂºèÁªìÊûú -->
            <div v-if="!form.storyboardMode">
              <el-row :gutter="20">
                <el-col :span="8">
                  <el-card class="result-card">
                    <template #header>
                      <div class="card-header-content">
                        <span>ÊïÖ‰∫ãÁÆÄ‰ªã</span>
                        <el-button type="primary" :icon="Refresh" circle plain size="small" @click="regeneratePart('synopsis')" />
                      </div>
                    </template>
                    <el-input v-model="result.synopsis" type="textarea" autosize class="result-text-input" />
                  </el-card>
                </el-col>
                <el-col :span="8">
                  <el-card class="result-card">
                    <template #header>
                      <div class="card-header-content">
                        <span>Âú∫ÊôØÈ¢ÑËÆæ</span>
                        <el-button type="primary" :icon="Refresh" circle plain size="small" @click="regeneratePart('scenePreset')" />
                      </div>
                    </template>
                    <el-input v-model="result.scenePreset" type="textarea" autosize class="result-text-input" />
                  </el-card>
                </el-col>
                <el-col :span="8">
                  <el-card class="result-card">
                    <template #header>
                      <div class="card-header-content">
                        <span>‰∫∫Áâ©È¢ÑËÆæ</span>
                        <el-button type="primary" :icon="Refresh" circle plain size="small" @click="regeneratePart('characterPreset')" />
                      </div>
                    </template>
                    <el-input v-model="result.characterPreset" type="textarea" autosize class="result-text-input" />
                  </el-card>
                </el-col>
              </el-row>
            </div>
            
            <!-- ÂàÜÈïúËÑöÊú¨Ê®°ÂºèÁªìÊûú -->
            <div v-else>
              <el-row :gutter="20" style="margin-bottom: 20px;">
                <el-col :span="12">
                  <el-card class="result-card">
                    <template #header>
                      <div class="card-header-content">
                        <span>üé¨ ÂàÜÈïúËÑöÊú¨</span>
                        <el-button type="primary" :icon="Refresh" circle plain size="small" @click="regeneratePart('storyboard')" />
                      </div>
                    </template>
                    <div v-if="result.storyboard" class="storyboard-container">
                      <div v-for="(shot, index) in result.storyboard" :key="index" class="shot-item">
                        <div class="shot-header">
                          <span class="shot-number">ÈïúÂ§¥ {{ index + 1 }}</span>
                          <span class="shot-type">{{ shot.type }}</span>
                        </div>
                        <div class="shot-description">{{ shot.description }}</div>
                        <div class="shot-duration">Êó∂Èïø: {{ shot.duration }}Áßí</div>
                      </div>
                    </div>
                  </el-card>
                </el-col>
                <el-col :span="12">
                  <el-card class="result-card">
                    <template #header>
                      <div class="card-header-content">
                        <span>üé® ÊñáÁîüÂõæÊèêÁ§∫ËØç</span>
                        <el-button type="primary" :icon="CopyDocument" circle plain size="small" @click="copyPrompts('imagePrompts')" />
                      </div>
                    </template>
                    <div v-if="result.imagePrompts" class="prompts-container">
                      <div v-for="(prompt, index) in result.imagePrompts" :key="index" class="prompt-item">
                        <div class="prompt-title">Âú∫ÊôØ {{ index + 1 }}</div>
                        <el-input v-model="prompt.text" type="textarea" autosize readonly class="prompt-text" />
                        <el-button size="small" @click="copyPrompt(prompt.text)" style="margin-top: 5px;">
                          Â§çÂà∂ÊèêÁ§∫ËØç
                        </el-button>
                      </div>
                    </div>
                  </el-card>
                </el-col>
              </el-row>
              
              <el-row :gutter="20">
                <el-col :span="24">
                  <el-card class="result-card">
                    <template #header>
                      <div class="card-header-content">
                        <span>üé• ÂõæÁîüËßÜÈ¢ëÊèêÁ§∫ËØç</span>
                        <el-button type="primary" :icon="CopyDocument" circle plain size="small" @click="copyPrompts('videoPrompts')" />
                      </div>
                    </template>
                    <div v-if="result.videoPrompts" class="prompts-container">
                      <div v-for="(prompt, index) in result.videoPrompts" :key="index" class="prompt-item">
                        <div class="prompt-title">ÈïúÂ§¥ {{ index + 1 }}</div>
                        <div class="prompt-content">
                          <div><strong>ÁîªÈù¢ÊèèËø∞:</strong> {{ prompt.imageDescription }}</div>
                          <div><strong>ËøêÂä®ÊèèËø∞:</strong> {{ prompt.motionDescription }}</div>
                          <div><strong>Áõ∏Êú∫ËøêÂä®:</strong> {{ prompt.cameraMovement }}</div>
                          <div><strong>Êó∂Èïø:</strong> {{ prompt.duration }}Áßí</div>
                          <div><strong>ÂÆåÊï¥ÊèêÁ§∫ËØç:</strong></div>
                          <el-input v-model="prompt.fullPrompt" type="textarea" autosize readonly class="prompt-text" />
                          <el-button size="small" @click="copyPrompt(prompt.fullPrompt)" style="margin-top: 5px;">
                            Â§çÂà∂ÊèêÁ§∫ËØç
                          </el-button>
                        </div>
                      </div>
                    </div>
                  </el-card>
                </el-col>
              </el-row>
            </div>

            <el-card class="table-card">
              <template #header>
                <div class="card-header-content">
                  <span>üìã ÂàÜÈïúËÑöÊú¨</span>
                  <div>
                    <el-button :icon="Refresh" @click="regenerateTable">ÈáçÊñ∞ÁîüÊàê</el-button>
                    <el-button :icon="Download" @click="exportTable">ÂØºÂá∫Ë°®Ê†º</el-button>
                  </div>
                </div>
              </template>
              <el-table :data="tableData" style="width: 100%" border>
                <el-table-column prop="shot" label="ÈïúÂ§¥" width="80" align="center" />
                <el-table-column prop="scene" label="Âú∫ÊôØÊèèËø∞" min-width="200" />
                <el-table-column prop="duration" label="Êó∂Èïø" width="80" align="center" />
                <el-table-column prop="camera" label="ËøêÈïú" width="100" />
                <el-table-column prop="effect" label="ÁâπÊïà" width="100" />
                <el-table-column label="ÁîªÈù¢" width="180" align="center">
                  <template #default="scope">
                    <div class="media-container">
                      <el-image 
                        v-if="scope.row.imageUrl" 
                        :src="scope.row.imageUrl" 
                        class="shot-image" 
                        fit="cover"
                      >
                        <template #error>
                          <div class="image-slot">
                            <el-icon><Picture /></el-icon>
                          </div>
                        </template>
                      </el-image>
                      <div v-else class="shot-image">
                        <el-icon><Picture /></el-icon>
                      </div>
                      <div class="media-overlay">
                        <div class="media-actions">
                          <el-button 
                            size="small" 
                            :icon="PictureRounded" 
                            circle 
                            @click="generateImage(scope.$index)"
                          />
                          <el-button 
                            size="small" 
                            :icon="VideoCamera" 
                            circle 
                            @click="generateVideo(scope.$index)"
                          />
                        </div>
                      </div>
                    </div>
                  </template>
                </el-table-column>
              </el-table>
            </el-card>
            
            <div class="optimization-panel">
              <h3 class="optimization-title">‰ºòÂåñÂ∑•ÂÖ∑</h3>
              <el-row :gutter="20">
                <el-col :span="12"><SmartRecommendations /></el-col>
                <el-col :span="12"><CacheManager /></el-col>
              </el-row>
            </div>
          </div>
        </div>
      </el-col>
    </el-row>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted, computed, watch, nextTick } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { MagicStick, FolderOpened, FolderAdd, Search, Refresh, Download, Picture, PictureRounded, VideoCamera, CopyDocument } from '@element-plus/icons-vue'
import SmartRecommendations from './SmartRecommendations.vue'
import CacheManager from './CacheManager.vue'

const projectPath = ref('')
const projectSearch = ref('')
const loading = ref(false)
const result = ref(null)
const activeCollapse = ref(['1'])
const storyboardCollapse = ref([''])
const showTemplateDialog = ref(false)
const templates = ref([])

const form = reactive({
  topic: '',
  style: 'cyberpunk',
  shots: 8,
  characterBio: '',
  storyOutline: '',
  specificScenes: '',
  negativePrompt: '',
  storyboardMode: false,
  visualStyle: '',
  cameraMovement: 'static',
  lightingEffect: 'natural',
  colorTone: 'cool'
})

const recommendedTags = ref([
  '#ÁßëÂπª', '#ËµõÂçöÊúãÂÖã', '#AI', '#Êú™Êù•', '#ÁßëÊäÄ', '#ÈÉΩÂ∏Ç', '#Â•áÂπª', '#ÂÜíÈô©'
])

const tableData = ref([])

const addTag = (tag) => {
  if (!form.topic.includes(tag)) {
    form.topic += ' ' + tag
  }
}

const optimizeTitle = () => {
  if (!form.topic.trim()) {
    ElMessage.warning('ËØ∑ÂÖàËæìÂÖ•ÊïÖ‰∫ã‰∏ªÈ¢ò')
    return
  }
  
  const optimizations = [
    'Á®ãÂ∫èÂëòÊâæÂõûÊï∞Â≠óÁå´ÁöÑËµõÂçöÊúãÂÖã‰πãÊóÖ',
    'ÈúìËôπÈÉΩÂ∏Ç‰∏ãÁöÑ‰ª£Á†Å‰∏éÊ∏©ÊÉÖÔºöÂØªÊâæAI‰ºô‰º¥',
    'ÂΩì‰ª£Á†ÅÈÅáËßÅÊÉÖÊÑüÔºöÊï∞Â≠ó‰∏ñÁïåÁöÑÂØªÁå´Â•áÈÅá'
  ]
  
  form.topic = optimizations[Math.floor(Math.random() * optimizations.length)]
  ElMessage.success('Ê†áÈ¢òÂ∑≤‰ºòÂåñÔºÅ')
}

const generateScript = async () => {
  if (!form.topic.trim()) {
    ElMessage.warning('ËØ∑ËæìÂÖ•ÊïÖ‰∫ã‰∏ªÈ¢òÔºÅ')
    return
  }

  loading.value = true
  
  // Ê®°ÊãüAIÂ§ÑÁêÜÊó∂Èó¥
  await new Promise(resolve => setTimeout(resolve, 2000))
  
  if (form.storyboardMode) {
    // ÂàÜÈïúËÑöÊú¨Ê®°Âºè
    const storyboard = generateStoryboard(form.topic, form.style, form.shots)
    const imagePrompts = generateImagePrompts(storyboard, form.style, form.visualStyle, form.cameraMovement, form.lightingEffect, form.colorTone)
    const videoPrompts = generateVideoPrompts(storyboard, form.style, form.cameraMovement, form.lightingEffect)
    
    result.value = {
      storyboard,
      imagePrompts,
      videoPrompts,
      synopsis: `ËøôÊòØ‰∏Ä‰∏™ÂÖ≥‰∫é${form.topic}ÁöÑ${form.style}È£éÊ†ºÊïÖ‰∫ãÔºåÈááÁî®ÂàÜÈïúËÑöÊú¨Ê®°ÂºèÔºåÂÖ±${form.shots}‰∏™ÈïúÂ§¥„ÄÇ`,
      scenePreset: `Êï¥‰ΩìÈ£éÊ†ºÔºö${getStyleDescription(form.style)}ÔºåÁîªÈù¢È£éÊ†ºÔºö${form.visualStyle || 'ÈªòËÆ§'}ÔºåÈïúÂ§¥ËøêÂä®Ôºö${form.cameraMovement}ÔºåÂÖâÂΩ±ÊïàÊûúÔºö${form.lightingEffect}ÔºåËâ≤ÂΩ©Ë∞ÉÊÄßÔºö${form.colorTone}`,
      characterPreset: `‰∏ªÈ¢òÔºö${form.topic}ÔºåÈ£éÊ†ºÔºö${form.style}ÔºåÈïúÂ§¥Êï∞Ôºö${form.shots}`,
      tableData: storyboard.map((shot, index) => ({
        shot: index + 1,
        content: shot.description,
        duration: shot.duration,
        notes: `${shot.type}ÈïúÂ§¥Ôºå${form.style}È£éÊ†º`
      }))
    }
  } else {
    // Ê†áÂáÜÊ®°Âºè
    result.value = {
      synopsis: `ËøôÊòØ‰∏Ä‰∏™ÂÖ≥‰∫é${form.topic}ÁöÑ${form.style}È£éÊ†ºÊïÖ‰∫ã„ÄÇ‰∏ªËßíÂú®${form.style === 'cyberpunk' ? 'ÈúìËôπÈó™ÁÉÅÁöÑÊú™Êù•ÈÉΩÂ∏Ç' : form.style === 'sci-fi' ? 'Êµ©ÁÄöÊó†Âû†ÁöÑÂÆáÂÆô' : form.style === 'fantasy-guofeng' ? '‰ªôÊ∞îÁº≠ÁªïÁöÑÂè§‰ª£‰∏ñÁïå' : 'Ê∏©È¶®Ê≤ªÊÑàÁöÑÊó•Â∏∏ÁîüÊ¥ª'}‰∏≠Â±ïÂºÄ‰∫Ü‰∏ÄÊÆµÊÉäÂøÉÂä®È≠ÑÁöÑÂÜíÈô©„ÄÇ`,
      scenePreset: `${form.style === 'cyberpunk' ? 'ËµõÂçöÊúãÂÖãÈÉΩÂ∏ÇÔºöÈ´òÊ•ºÊûóÁ´ãÔºåÈúìËôπÈó™ÁÉÅÔºåÂÖ®ÊÅØÂπøÂëäÂú®Á©∫‰∏≠ÊºÇÊµÆÔºåÈ£ûË°åÊ±ΩËΩ¶Á©øÊ¢≠‰∫éÊ•ºÂÆá‰πãÈó¥' : form.style === 'sci-fi' ? 'Â§™Á©∫Âú∫ÊôØÔºöÂÆáÂÆôÈ£ûËàπÂú®ÊòüÁ©∫‰∏≠Ëà™Ë°åÔºåÂ§ñÊòüÊñáÊòéÁöÑÂª∫Á≠ëÂÖÖÊª°Êú™Êù•ÊÑüÔºåÈ´òÁßëÊäÄËÆæÂ§áÈöèÂ§ÑÂèØËßÅ' : form.style === 'fantasy-guofeng' ? 'Âè§È£éÂú∫ÊôØÔºö‰∫≠Âè∞Ê•ºÈòÅÔºåÂ±±Ê∞¥Â¶ÇÁîªÔºå‰ªôÊ∞îÁº≠ÁªïÔºåÂè§‰ª£Âª∫Á≠ë‰∏éËá™ÁÑ∂ÂÆåÁæéËûçÂêà' : 'Êó•Â∏∏Âú∫ÊôØÔºöÊ∏©È¶®ÁöÑÂÆ∂Â∫≠ÁéØÂ¢ÉÔºåÈò≥ÂÖâÈÄèËøáÁ™óÊà∑Ê¥íËøõÊù•ÔºåÁîüÊ¥ªÊ∞îÊÅØÊµìÂéö'}„ÄÇ`,
      characterPreset: `‰∏ªËßíÔºö${form.characterBio || '‰∏Ä‰∏™ÂãáÊï¢ËÄåÊô∫ÊÖßÁöÑÂπ¥ËΩª‰∫∫'}Ôºå${form.style === 'cyberpunk' ? 'Âú®Êú™Êù•ÁßëÊäÄÁ§æ‰ºö‰∏≠ÂØªÊâæËá™Êàë' : form.style === 'sci-fi' ? 'Âú®ÊòüÈôÖÊé¢Á¥¢‰∏≠ÂèëÁé∞ÂÆáÂÆôÂ••Áßò' : form.style === 'fantasy-guofeng' ? 'Âú®‰øÆ‰ªô‰∏ñÁïå‰∏≠ËøΩÊ±ÇÂ§ßÈÅì' : 'Âú®Êó•Â∏∏ÁîüÊ¥ª‰∏≠ÂèëÁé∞ÁæéÂ•Ω'}„ÄÇ`,
      tableData: Array.from({ length: form.shots }, (_, i) => ({
        shot: i + 1,
        content: `Á¨¨${i + 1}‰∏™ÈïúÂ§¥Ôºö${form.topic}ÁöÑ${form.style}È£éÊ†ºÂú∫ÊôØ`,
        duration: Math.floor(Math.random() * 5) + 1,
        notes: `${form.style}È£éÊ†ºÔºå${form.characterBio ? '‰ΩìÁé∞‰∏ªËßíÊÄßÊ†º' : 'Á™ÅÂá∫‰∏ªÈ¢ò'}`
      }))
    }
  }
  
  tableData.value = result.value.tableData
  loading.value = false
  ElMessage.success('AIËÑöÊú¨ÁîüÊàêÂÆåÊàêÔºÅ')
}

const regeneratePart = (part) => {
  const variations = {
    synopsis: [
      'ËøôÊòØ‰∏Ä‰∏™ÂÖ≥‰∫éÂãáÊ∞î‰∏éÂèëÁé∞ÁöÑÊïÖ‰∫ãÔºå‰∏ªËßíÂú®Êú™Áü•ÁöÑÊóÖÁ®ã‰∏≠ÊâæÂà∞‰∫ÜÁúüÊ≠£ÁöÑËá™Êàë„ÄÇ',
      'Âú®ÁßëÊäÄ‰∏éÊÉÖÊÑüÁöÑ‰∫§Áªá‰∏≠ÔºåÊïÖ‰∫ãÂ±ïÁé∞‰∫Ü‰∫∫ÊÄßÊúÄÁæéÂ•ΩÁöÑ‰∏ÄÈù¢„ÄÇ',
      '‰∏ÄÊÆµË∑®Ë∂äÊó∂Á©∫ÁöÑÂÜíÈô©ÔºåÊúÄÁªàÂõûÂΩíÂÜÖÂøÉÁöÑÂπ≥Èùô‰∏éÊàêÈïø„ÄÇ'
    ],
    scenePreset: [
      'ÂÖâÂΩ±‰∫§ÈîôÁöÑËßÜËßâÊïàÊûúÔºåËê•ÈÄ†Âá∫Ê¢¶ÂπªËÄåÁúüÂÆûÁöÑÊ∞õÂõ¥„ÄÇ',
      'ÁªÜËÖªÁöÑÁéØÂ¢ÉÂàªÁîªÔºåËÆ©ÊØè‰∏™Âú∫ÊôØÈÉΩÂÖÖÊª°ÁîüÂëΩÂäõ„ÄÇ',
      'Ëâ≤ÂΩ©‰∏éÊûÑÂõæÁöÑÂÆåÁæéÁªìÂêàÔºåÂëàÁé∞Âá∫ÁîµÂΩ±Ëà¨ÁöÑË¥®ÊÑü„ÄÇ'
    ],
    characterPreset: [
      'ËßíËâ≤ÁöÑÂÜÖÂøÉÂèòÂåñË¥ØÁ©øÂßãÁªàÔºåÂ±ïÁé∞‰∫∫ÊÄßÁöÑÂ§çÊùÇ‰∏éÁæéÂ•Ω„ÄÇ',
      'ÊØè‰∏™ËßíËâ≤ÈÉΩÊúâÁã¨ÁâπÁöÑ‰∏™ÊÄßÂíåÂä®‰∫∫ÁöÑÊàêÈïøËΩ®Ëøπ„ÄÇ',
      'ÈÄöËøáËßíËâ≤ÁöÑÁúºÁùõÔºåÊàë‰ª¨ÁúãÂà∞‰∫ÜÊõ¥ÂπøÈòîÁöÑ‰∏ñÁïå„ÄÇ'
    ]
  }
  
  if (result.value && variations[part]) {
    const options = variations[part]
    result.value[part] = options[Math.floor(Math.random() * options.length)]
  }
}

const regenerateTable = () => {
  tableData.value = Array.from({ length: form.shots }, (_, i) => ({
    shot: i + 1,
    scene: `ÈáçÊñ∞ÁîüÊàêÁöÑÁ¨¨${i + 1}‰∏™ÈïúÂ§¥ÂÜÖÂÆπ`,
    duration: `${Math.floor(Math.random() * 5) + 3}Áßí`,
    camera: ['Êé®Èïú', 'ÊãâÈïú', 'ÊëáÊëÑ', 'ÁßªÊëÑ', 'Ë∑üÊãç'][Math.floor(Math.random() * 5)],
    effect: ['Ê∑°ÂÖ•Ê∑°Âá∫', 'Èó™ÁôΩ', 'Áº©Êîæ', 'ÊóãËΩ¨', 'ÈùôÊ≠¢'][Math.floor(Math.random() * 5)],
    imageUrl: ''
  }))
}

const exportTable = () => {
  const data = tableData.value.map(row => ({
    ÈïúÂ§¥: row.shot,
    Âú∫ÊôØÊèèËø∞: row.scene,
    Êó∂Èïø: row.duration,
    ËøêÈïú: row.camera,
    ÁâπÊïà: row.effect
  }))
  
  const ws = XLSX.utils.json_to_sheet(data)
  const wb = XLSX.utils.book_new()
  XLSX.utils.book_append_sheet(wb, ws, 'ÂàÜÈïúËÑöÊú¨')
  XLSX.writeFile(wb, `${form.topic || 'AIËÑöÊú¨'}.xlsx`)
}

const generateImage = (index) => {
  ElMessage.info(`Ê≠£Âú®ÁîüÊàêÁ¨¨${index + 1}‰∏™ÈïúÂ§¥ÁöÑÂõæÁâá...`)
  tableData.value[index].imageUrl = `https://via.placeholder.com/160x100?text=ÈïúÂ§¥${index + 1}`
}

const generateVideo = (index) => {
  ElMessage.info(`Ê≠£Âú®ÁîüÊàêÁ¨¨${index + 1}‰∏™ÈïúÂ§¥ÁöÑËßÜÈ¢ëÈ¢ÑËßà...`)
}

const saveAsTemplate = () => {
  if (!form.topic.trim()) {
    ElMessage.warning('ËØ∑ËæìÂÖ•Ê®°ÊùøÂêçÁß∞')
    return
  }
  
  const template = {
    name: form.topic,
    form: { ...form },
    timestamp: Date.now()
  }
  
  templates.value.push(template)
  localStorage.setItem('aiScriptTemplates', JSON.stringify(templates.value))
  ElMessage.success('Ê®°ÊùøÂ∑≤‰øùÂ≠òÔºÅ')
}

const loadTemplate = () => {
  showTemplateDialog.value = true
}

const applyTemplate = (template) => {
  Object.assign(form, template.form)
  showTemplateDialog.value = false
  ElMessage.success(`Ê®°Êùø "${template.name}" Â∑≤Â∫îÁî®`)
}

const saveProject = () => {
  if (!form.topic && !result.value) {
    ElMessage.warning('Ê≤°ÊúâÂèØ‰øùÂ≠òÁöÑÂÜÖÂÆπÔºÅ')
    return
  }
  try {
    const projectData = {
      form: form,
      result: result.value,
      tableData: tableData.value
    }
    const dataStr = JSON.stringify(projectData, null, 2)
    const blob = new Blob([dataStr], { type: 'application/json' })
    const url = URL.createObjectURL(blob)
    const link = document.createElement('a')
    const sanitizeFilename = (name) => {
      if (!name) return 'ai-project'
      return name.replace(/[\/\\?%*:|"<>]/g, '_').substring(0, 50)
    }
    link.href = url
    link.download = `${sanitizeFilename(form.topic)}.aiproj.json`
    document.body.appendChild(link)
    link.click()
    document.body.removeChild(link)
    URL.revokeObjectURL(url)
    ElMessage.success('È°πÁõÆÂ∑≤‰øùÂ≠òÔºÅ')
  } catch (error) {
    console.error('Failed to save project:', error)
    ElMessage.error('È°πÁõÆ‰øùÂ≠òÂ§±Ë¥•ÔºÅ')
  }
}

const loadProject = () => {
  const input = document.createElement('input')
  input.type = 'file'
  input.accept = '.aiproj.json,application/json'
  input.onchange = (e) => {
    const file = e.target.files[0]
    if (!file) return
    const reader = new FileReader()
    reader.onload = (res) => {
      try {
        const projectData = JSON.parse(res.target.result)
        if (projectData.form && projectData.result) {
          Object.assign(form, projectData.form)
          result.value = projectData.result
          tableData.value = projectData.tableData || []
          ElMessage.success(`È°πÁõÆ "${form.topic}" Â∑≤Âä†ËΩΩÔºÅ`)
        } else {
          ElMessage.error('Êó†ÊïàÁöÑÈ°πÁõÆÊñá‰ª∂Ê†ºÂºèÔºÅ')
        }
      } catch (error) {
        console.error('Failed to load project:', error)
        ElMessage.error('Âä†ËΩΩÈ°πÁõÆÂ§±Ë¥•ÔºÅ')
      }
    }
    reader.readAsText(file)
  }
  input.click()
}

const selectProjectFolder = async () => {
  const path = await window.electronAPI.selectDirectory()
  if (path) {
    projectPath.value = path
    ElMessage.success(`È°πÁõÆÊñá‰ª∂Â§πÂ∑≤ËÆæÁΩÆ‰∏∫Ôºö${path}`)
  }
}

// Â§çÂà∂ÊèêÁ§∫ËØçÂäüËÉΩ
const copyPrompt = (text) => {
  navigator.clipboard.writeText(text).then(() => {
    ElMessage.success('ÊèêÁ§∫ËØçÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø')
  }).catch(() => {
    ElMessage.error('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂')
  })
}

const copyPrompts = (type) => {
  if (!result.value || !result.value[type]) return
  
  const prompts = result.value[type].map(p => p.text || p.fullPrompt).join('\n\n')
  copyPrompt(prompts)
}

// ÁîüÊàêÂàÜÈïúËÑöÊú¨
const generateStoryboard = (topic, style, shots) => {
  const storyboard = []
  const shotTypes = ['ËøúÊôØ', '‰∏≠ÊôØ', 'ËøëÊôØ', 'ÁâπÂÜô', 'ÂÖ®ÊôØ', '‰øØÊãç', '‰ª∞Êãç']
  const sceneDescriptions = {
    'cyberpunk': [
      'ÈúìËôπÁÅØÈó™ÁÉÅÁöÑÊú™Êù•ÈÉΩÂ∏ÇÂ§úÊôØ',
      'È´òÊ•ºÂ§ßÂé¶Èó¥ÁöÑÂÖ®ÊÅØÊäïÂΩ±ÂπøÂëä',
      'Èò¥ÊöóÂ∞èÂ∑∑‰∏≠ÁöÑÈúìËôπÁÅØÂÖâ',
      'ÁßëÊäÄÊÑüÂçÅË∂≥ÁöÑÂª∫Á≠ëÂ§ñËßÇ',
      'ÂÖÖÊª°Êú™Êù•ÊÑüÁöÑ‰∫§ÈÄöÂ∑•ÂÖ∑',
      'ËµõÂçöÊúãÂÖãÈ£éÊ†ºÁöÑÂÆ§ÂÜÖÂú∫ÊôØ',
      'È´òÁßëÊäÄËÆæÂ§á‰∏éÂè§ËÄÅÂª∫Á≠ëÁöÑÂØπÊØî',
      'ÈúìËôπÁÅØ‰∏ãÁöÑÈõ®Â§úË°óÈÅì'
    ],
    'sci-fi': [
      'ÂÆáÂÆôÈ£ûËàπÁöÑÈ©æÈ©∂Ëà±',
      'Â§ñÊòüÁêÉÁöÑÂ•áÁâπÂú∞Ë≤å',
      'È´òÁßëÊäÄÂÆûÈ™åÂÆ§',
      'Â§™Á©∫Á´ôÁöÑÂÖ®ÊôØ',
      'Êú™Êù•ÂüéÂ∏ÇÁöÑÂ§©ÈôÖÁ∫ø',
      'Êú∫Âô®‰∫∫ÁöÑÁâπÂÜôÈïúÂ§¥',
      'ÊòüÈôÖÊóÖË°åÁöÑÂú∫ÊôØ',
      'Êó∂Èó¥ÈößÈÅìÁöÑËßÜËßâÊïàÊûú'
    ],
    'fantasy-guofeng': [
      'Âè§‰ª£ÂÆ´ÊÆøÁöÑÂÆè‰ºüÂª∫Á≠ë',
      'Â±±Ê∞¥Èó¥ÁöÑËØóÊÑèÁîªÈù¢',
      '‰ªô‰æ†‰∏ñÁïåÁöÑÂ•áÂπªÂú∫ÊôØ',
      'Âè§‰ª£Ë°óÈÅìÁöÑÁÉ≠ÈóπÊôØË±°',
      '‰º†ÁªüÂª∫Á≠ëÁöÑÁ≤æÁæéÁªÜËäÇ',
      'Ëá™ÁÑ∂È£éÂÖâÁöÑÂ£Æ‰∏ΩÊôØËâ≤',
      'Âè§‰ª£ÊúçÈ•∞ÁöÑÂçéÁæéÂ±ïÁ§∫',
      'Á•ûËØù‰º†ËØ¥ÁöÑÂú∫ÊôØÂÜçÁé∞'
    ],
    'slice-of-life': [
      'Ê∏©È¶®ÁöÑÂÆ∂Â±ÖÁéØÂ¢É',
      'Êó•Â∏∏ÁîüÊ¥ªÁöÑÁúüÂÆûÁû¨Èó¥',
      '‰∫∫Áâ©ÁöÑËá™ÁÑ∂Ë°®ÊÉÖ',
      'Ê∏©ÊöñÁöÑÂÖâÂΩ±ÊïàÊûú',
      'ÁîüÊ¥ªÁªÜËäÇÁöÑÁâπÂÜô',
      '‰∫∫Áâ©‰∫íÂä®ÁöÑÊ∏©È¶®Âú∫ÊôØ',
      'Êó•Â∏∏Áî®ÂìÅÁöÑÁ≤æÁæéÂ±ïÁ§∫',
      'ÁîüÊ¥ªÂú∫ÊôØÁöÑÁúüÂÆûËÆ∞ÂΩï'
    ]
  }

  for (let i = 0; i < shots; i++) {
    const sceneArray = sceneDescriptions[style] || sceneDescriptions['cyberpunk']
    const sceneDesc = sceneArray[i % sceneArray.length]
    const shotType = shotTypes[i % shotTypes.length]
    
    storyboard.push({
      type: shotType,
      description: `${sceneDesc}Ôºå${getStyleDescription(style)}`,
      duration: Math.floor(Math.random() * 5) + 2
    })
  }
  
  return storyboard
}

// ÁîüÊàêÊñáÁîüÂõæÊèêÁ§∫ËØç
const generateImagePrompts = (storyboard, style, visualStyle, cameraMovement, lightingEffect, colorTone) => {
  const baseStyles = {
    'cyberpunk': 'cyberpunk style, neon lights, futuristic city, high tech, dark atmosphere, neon glow, sci-fi',
    'sci-fi': 'science fiction style, futuristic technology, space theme, advanced civilization, high tech',
    'fantasy-guofeng': 'Chinese fantasy style, ancient architecture, traditional elements, oriental aesthetics, mythological',
    'slice-of-life': 'daily life style, warm atmosphere, natural lighting, realistic, documentary style'
  }
  
  const lightingStyles = {
    'natural': 'natural lighting, soft light',
    'dramatic': 'dramatic lighting, strong contrast, cinematic',
    'neon': 'neon lights, colorful glow, cyberpunk lighting',
    'backlight': 'backlighting, silhouette effect, rim light',
    'soft': 'soft lighting, diffused light, gentle shadows',
    'hard': 'hard lighting, strong shadows, high contrast'
  }
  
  const colorStyles = {
    'cool': 'cool color palette, blue tones, cyan, teal',
    'warm': 'warm color palette, orange tones, golden hour, cozy',
    'high_contrast': 'high contrast, vivid colors, saturated',
    'desaturated': 'desaturated colors, muted tones, vintage',
    'cyberpunk': 'cyberpunk colors, neon pink and cyan, electric blue',
    'vintage': 'vintage colors, film look, nostalgic, retro'
  }

  return storyboard.map((shot, index) => ({
    text: `${shot.description}, ${baseStyles[style] || baseStyles['cyberpunk']}, ${lightingStyles[lightingEffect] || lightingStyles['natural']}, ${colorStyles[colorTone] || colorStyles['cool']}, ${visualStyle || ''}, ${cameraMovement} camera movement, ${shot.type} shot, 4K resolution, high quality, detailed, cinematic`
  }))
}

// ÁîüÊàêÂõæÁîüËßÜÈ¢ëÊèêÁ§∫ËØç
const generateVideoPrompts = (storyboard, style, cameraMovement, lightingEffect) => {
  const movementDescriptions = {
    'static': 'static camera, fixed position',
    'push_pull': 'smooth push in/pull out camera movement',
    'pan': 'smooth panning camera movement',
    'tracking': 'tracking shot, following the subject',
    'rotation': 'rotating camera movement, 360 degree view',
    'crane': 'crane shot, smooth vertical movement'
  }

  return storyboard.map((shot, index) => {
    const motionDesc = getMotionDescription(shot.type)
    const cameraDesc = movementDescriptions[cameraMovement] || movementDescriptions['static']
    
    return {
      imageDescription: shot.description,
      motionDescription: motionDesc,
      cameraMovement: cameraDesc,
      duration: shot.duration,
      fullPrompt: `${shot.description}, ${motionDesc}, ${cameraDesc}, ${lightingEffect} lighting, ${style} style, smooth motion, high quality video, cinematic, 4K`
    }
  })
}

// ËæÖÂä©ÂáΩÊï∞
const getStyleDescription = (style) => {
  const descriptions = {
    'cyberpunk': 'ÂÖÖÊª°ÁßëÊäÄÊÑüÁöÑËµõÂçöÊúãÂÖãÈ£éÊ†º',
    'sci-fi': 'ÁßëÂπªÊú™Êù•ÁöÑÂ§™Á©∫È£éÊ†º',
    'fantasy-guofeng': '‰∏≠ÂõΩ‰º†Áªü‰ªô‰æ†È£éÊ†º',
    'slice-of-life': 'Ê∏©È¶®Ê≤ªÊÑàÁöÑÊó•Â∏∏ÁîüÊ¥ªÈ£éÊ†º'
  }
  return descriptions[style] || descriptions['cyberpunk']
}

const getMotionDescription = (shotType) => {
  const motions = {
    'ËøúÊôØ': 'Â±ïÁé∞ÂÆèÂ§ßÂú∫ÊôØÁöÑÂÖ®ÊôØËøêÂä®',
    '‰∏≠ÊôØ': 'Á™ÅÂá∫‰∏ª‰ΩìÁöÑÂπ≥Á®≥ËøêÂä®',
    'ËøëÊôØ': 'ÁªÜËÖªÁöÑ‰∫∫Áâ©Ë°®ÊÉÖÂèòÂåñ',
    'ÁâπÂÜô': 'Âº∫Ë∞ÉÁªÜËäÇÁâπÂÜôÁöÑÁºìÊÖ¢ËøêÂä®',
    'ÂÖ®ÊôØ': 'Â±ïÁ§∫ÂÆåÊï¥Âú∫ÊôØÁöÑÂÖ®Êñπ‰ΩçËøêÂä®',
    '‰øØÊãç': '‰ªé‰∏äÂæÄ‰∏ãÁöÑ‰øØÁû∞ËßÜËßíËøêÂä®',
    '‰ª∞Êãç': '‰ªé‰∏ãÂæÄ‰∏äÁöÑ‰ª∞ËßÜËßÜËßíËøêÂä®'
  }
  return motions[shotType] || 'Ëá™ÁÑ∂ÁöÑÈïúÂ§¥ËøêÂä®'
}

onMounted(() => {
  const savedTemplates = localStorage.getItem('aiScriptTemplates')
  if (savedTemplates) {
    templates.value = JSON.parse(savedTemplates)
  }

  // Load last session from localStorage
  const savedForm = localStorage.getItem('aiScriptWriterForm')
  if (savedForm) {
    Object.assign(form, JSON.parse(savedForm))
    ElMessage.success('Â∑≤ÊÅ¢Â§ç‰∏äÊ¨°ÁöÑÁºñËæëÂÜÖÂÆπ')
  }
})

// Debounce function
const debounce = (fn, delay) => {
  let timeoutId
  return (...args) => {
    clearTimeout(timeoutId)
    timeoutId = setTimeout(() => fn(...args), delay)
  }
}

// Watch for form changes and save to localStorage
watch(form, debounce((newForm) => {
  localStorage.setItem('aiScriptWriterForm', JSON.stringify(newForm))
}, 500))
</script>

<style scoped>
.page-container {
  padding: 20px;
}
.page-title {
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 8px;
}
.page-subtitle {
  font-size: 14px;
  color: var(--text-color-secondary);
  margin-bottom: 20px;
}
.control-panel, .result-container {
  display: flex;
  flex-direction: column;
}
.placeholder {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
}
.card-header {
  font-size: 18px;
  font-weight: 600;
  color: var(--text-color-primary);
}

.card-header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}
.result-card {
  margin-bottom: 20px;
}
.result-text-input .el-textarea__inner {
  box-shadow: none !important;
  border: 1px solid transparent;
  background-color: transparent;
  padding: 0;
  font-size: 14px;
  line-height: 1.6;
  color: var(--text-color-primary);
  resize: none;
}
.result-text-input .el-textarea__inner:hover {
  border-color: var(--border-color);
}
.result-text-input .el-textarea__inner:focus {
  border-color: var(--accent-color);
}
.table-card {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
}
.el-table {
  --el-table-border-color: var(--border-color);
  --el-table-header-bg-color: #fafafa;
  --el-table-tr-bg-color: var(--card-bg-color);
  --el-table-row-hover-bg-color: #ecf5ff;
  --el-table-header-text-color: var(--text-color-secondary);
  border-radius: 8px;
  overflow: hidden;
}
.el-table th.el-table__cell {
  font-weight: 600;
  color: var(--text-color-secondary);
}
.media-container {
  position: relative;
  width: 160px;
  height: 100px;
  border-radius: 4px;
  overflow: hidden;
}
.shot-image, .shot-video {
  width: 100%;
  height: 100%;
  background-color: #f5f7fa;
  display: flex;
  justify-content: center;
  align-items: center;
  object-fit: cover;
}
.media-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.4);
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  transition: opacity 0.3s ease;
}
.media-container:hover .media-overlay {
  opacity: 1;
}
.media-actions {
  display: flex;
  gap: 10px;
}
.image-slot {
  font-size: 24px;
  color: #c0c4cc;
}
.details-collapse {
  margin-bottom: 18px;
  border-top: none;
  border-bottom: none;
}
.details-collapse .el-collapse-item__header {
  border-bottom: none;
  font-size: 14px;
  font-weight: 500;
}
.details-collapse .el-collapse-item__wrap {
  border-bottom: none;
}
.details-collapse .el-collapse-item__content {
  padding-bottom: 0;
}
.optimization-panel {
  margin-top: 20px;
  padding: 20px;
  background-color: #fafafa;
  border-radius: 8px;
}
.optimization-title {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 15px;
}
</style>
